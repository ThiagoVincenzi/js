<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <div id="content">

    </div>
    



    <script type="text/javascript">
        window.onload = function () {
            carregaPedidos();
        };

        async function carregaPedidos() {
            let keys = Object.keys(localStorage);
            const items = { ...localStorage }
            // console.log(items)
            for (let i = 0; i < keys.length; i++) {
                if (keys[i] != 'undefined' && keys[i] != 'Carrinho') {
                    let [linha, linhaTotal] = await insertTable(items[keys[i]]);

                    
                    let content = `<table border="1">
                                 <thead>
                                     <tr>
                                         <th>Produto</th>
                                         <th>Valor unit√°rio</th>
                                         <th>Quantidade</th>
                                         <th>Total do Item</th>
                                     </tr>
                                 </thead>

                                 <tbody>
                                    <tr> ${linha.innerHTML}</tr>
                                    <tr> ${linhaTotal.innerHTML}</tr>
                                 </tbody>
                             </table><br><br><br><br><br>`

                    let cont = document.createElement('div')
                    cont.innerHTML = content
                    document.getElementById('content').appendChild(cont)
                }
            }
        };
        function atualizar(dados) {
            let linhas = document.getElementById(dados).rows;
            for (let i = linhas.length - 1; i >= 0; i--) {
                document.getElementById(dados).deleteRow(i);
            }
            carregaTabela();
        }

        async function insertTable(pedido) {
            return new Promise(async (resolve, reject) => {
                pedido = JSON.parse(pedido)
                let cliente = pedido[0]
                let carrinho = pedido[1]
                let ValorTotal = 0

                let linha = ''
                let produto = ''
                let preco = ''
                let quant = ''
            
                
                for (let l = 0; l < carrinho.length; l++) {
                    // cria uma linha
                    linha = document.createElement('tr')

                    produto += `<td>${carrinho[l].produto.id}</td>`
                    preco += `<td>${carrinho[l].produto.valor}</td>`
                    quant += `<td>${carrinho[l].qtd}</td>`
                    linha.innerHTML += produto
                    linha.innerHTML += preco
                    linha.innerHTML += quant

                    ValorTotal += (carrinho[l].produto.valor * carrinho[l].qtd);
                    
                }
                
                
                let val = await valor(ValorTotal);
                let linhaTotal = document.createElement('tr')
                linhaTotal.innerHTML = `<tr><td colSpan = 3>Total</td><td>${val}</td></tr>`;
                console.log(linha)
                resolve([linha, linhaTotal])
            })
        }


    </script>
    <script src="js/funcoes.js"></script>
</body>

</html>